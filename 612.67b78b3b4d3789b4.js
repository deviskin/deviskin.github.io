(()=>{"use strict";function f(r){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function i(r,e,t){return(e=function C(r){var e=function E(r,e){if("object"!==f(r)||null===r)return r;var t=r[Symbol.toPrimitive];if(void 0!==t){var s=t.call(r,e||"default");if("object"!==f(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(r)}(r,"string");return"symbol"===f(e)?e:String(e)}(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class b{constructor(e,t){i(this,"workerId",void 0),i(this,"message",void 0),this.workerId=e,this.message=t}static builder(){return new b(-1,null)}setWorkerId(e){return this.workerId=e,this}setMessage(e){return this.message=e,this}}let k=(()=>{class r{constructor(t){i(this,"type",void 0),i(this,"id",0),i(this,"callbackId",-1),this.type=t,this.id=r.newId()}static newId(){return r.staticId++}setCallbackId(t){return this.callbackId=t,this}}return i(r,"staticId",0),r})(),B=(()=>{class r extends k{constructor(t){super(r.TYPE),i(this,"pageLoadedFrom",void 0),this.pageLoadedFrom=t}static builder(){return new r("")}setPageLoadedFrom(t){return this.pageLoadedFrom=t,this}}return i(r,"TYPE","SetupWorkerRequest"),r})();class c extends k{}let M=(()=>{class r extends c{constructor(t,s){super(r.TYPE),i(this,"libraryRef",void 0),i(this,"libraryType",void 0),this.libraryRef=t,this.libraryType=s}static builder(){return new r("","")}setLibraryRef(t){return this.libraryRef=t,this}setLibraryType(t){return this.libraryType=t,this}}return i(r,"TYPE","LibraryInfoRequest"),r})(),N=(()=>{class r extends c{constructor(t,s,n){super(r.TYPE),i(this,"libraryType",void 0),i(this,"bookRef",void 0),i(this,"loadBooksEnabled",void 0),this.libraryType=t,this.bookRef=s,this.loadBooksEnabled=n}static builder(){return new r("","",!0)}setLibraryType(t){return this.libraryType=t,this}setBookRef(t){return this.bookRef=t,this}setLoadBooksEnabled(t){return this.loadBooksEnabled=t,this}}return i(r,"TYPE","BookInfoRequest"),r})(),O=(()=>{class r extends c{constructor(t,s,n){super(r.TYPE),i(this,"libraryType",void 0),i(this,"bookRef",void 0),i(this,"languages",void 0),this.libraryType=t,this.bookRef=s,this.languages=n}static builder(){return new r("","",[])}setLibraryType(t){return this.libraryType=t,this}setBookRef(t){return this.bookRef=t,this}setLanguages(t){return this.languages=t,this}addLanguage(t){return this.languages.push(t),this}}return i(r,"TYPE","BookRequest"),r})(),H=(()=>{class r extends c{constructor(t){super(r.TYPE),i(this,"pages",void 0),this.pages=t}static builder(){return new r([])}setBookPages(t){return this.pages=t,this}addBookPage(t){return this.pages.push(t),this}}return i(r,"TYPE","PagesRequest"),r})(),q=(()=>{class r extends c{constructor(t){super(r.TYPE),i(this,"pages",void 0),this.pages=t}static builder(){return new r([])}setPages(t){return this.pages=t,this}addPage(t){return this.pages.push(t),this}}return i(r,"TYPE","PagesResponse"),r})();class m{constructor(e,t,s){i(this,"bookRef",void 0),i(this,"path",void 0),i(this,"content",void 0),this.bookRef=e,this.path=t,this.content=s}static builder(){return new m("","","")}setBookRef(e){return this.bookRef=e,this}setPath(e){return this.path=e,this}setContent(e){return this.content=e,this}}let F=(()=>{class r extends c{constructor(t){super(r.TYPE),i(this,"metaBooks",void 0),this.metaBooks=t}static builder(){return new r([])}setMetaBooks(t){return this.metaBooks=t,this}addMetaBook(t){return this.metaBooks.push(t),this}}return i(r,"TYPE","BookResponse"),r})(),Y=(()=>{class r extends c{constructor(t,s,n){super(r.TYPE),i(this,"bookRef",void 0),i(this,"metaContent",void 0),i(this,"loadBooksEnabled",void 0),this.bookRef=t,this.metaContent=s,this.loadBooksEnabled=n}static builder(){return new r("","",!0)}setBookRef(t){return this.bookRef=t,this}setMetaContent(t){return this.metaContent=t,this}setLoadBooksEnabled(t){return this.loadBooksEnabled=t,this}}return i(r,"TYPE","BookInfoResponse"),r})(),D=(()=>{class r extends c{constructor(t,s){super(r.TYPE),i(this,"libraryRef",void 0),i(this,"metaContent",void 0),this.libraryRef=t,this.metaContent=s}static builder(){return new r("","")}setLibraryRef(t){return this.libraryRef=t,this}setMetaContent(t){return this.metaContent=t,this}}return i(r,"TYPE","LibraryInfoResponse"),r})();class V{constructor(e=null){i(this,"messageSender",void 0),i(this,"requests",new Map),this.messageSender=e}send(e,t){return this.messageSender&&(this.requests.set(t.type,t),this.messageSender(e,t)),this}post(e,t){return this}runAll(e,t,s){let n=0,o=()=>{if(n>=e.length)return void(s&&s(!0));let a=e[n++];t(a,l=>{l?o():s&&s(!1)})};o()}}class g{static merge(e,t){if(!e&&!t)return"";if(!e)return t;if(!t)return e;let s=e.endsWith("/"),n=t.startsWith("/"),o=e;return s!=n?o+=t:s?o+=n?t.substring(1):t:o?o+="/"+t:o=t,o}}class P{static dtr(e,t){for(var s=t>=0?t:47,n=new ArrayBuffer(e.length-1),o=new Uint8Array(n),a=s,l=0;l<e.length;++l){var y=255&(e[l]^a);l>0&&(o[l-1]=y),a=255&(a+y^5)}return o}static fromByteArray(e){let t="";for(let s=0;s<e.length;s+=2)t+=String.fromCharCode(e[s+1]<<8|e[s]);return t}}const S="2.0.380",$=[{id:"deviskin",name:"Deviskin",nameSortOrder:"Deviskin",link:"http://deviskin.github.io"}];class d{constructor(e,t,s,n,o,a,l,p,y,G){i(this,"id",void 0),i(this,"name",void 0),i(this,"shape",void 0),i(this,"routes",void 0),i(this,"routeEnabled",void 0),i(this,"applicationEnabled",void 0),i(this,"applicationHidden",void 0),i(this,"applicationLogoText",void 0),i(this,"libraryType",void 0),i(this,"libraryRef",void 0),this.id=e,this.name=t,this.shape=s,this.routes=n,this.routeEnabled=o,this.applicationEnabled=a,this.applicationHidden=l,this.applicationLogoText=p,this.libraryType=y,this.libraryRef=G}static builder(){return new d("","","",[],!1,!1,!1,"","prod","book")}setId(e){return this.id=e,this}setName(e){return this.name=e,this}setShape(e){return this.shape=e,this}setRoutes(e){return this.routes=e,this}setRouteEnabled(e){return this.routeEnabled=e,this}setApplicatioinEnabled(e){return this.applicationEnabled=e,this}setApplicationLogoText(e){return this.applicationLogoText=e,this}setLibraryType(e){return this.libraryType=e,this}setLibraryRef(e){return this.libraryRef=e,this}enable(e=!0){return this.routeEnabled=e,this.applicationEnabled=e,this}hide(e=!0){return this.applicationHidden=e,this}disable(){return this.routeEnabled=!1,this.applicationEnabled=!1,this}}class h{constructor(e,t,s,n,o,a=null,l=null){i(this,"link",void 0),i(this,"name",void 0),i(this,"shape",void 0),i(this,"hasBadge",void 0),i(this,"hasAlert",void 0),i(this,"onClick",void 0),i(this,"isActive",void 0),this.link=e,this.name=t,this.shape=s,this.hasBadge=n,this.hasAlert=o,this.onClick=a,this.isActive=l}static builder(){return new h("","","",!1,!1)}setIsActive(e){return this.isActive=e,this}setOnClick(e){return this.onClick=e,this}setLink(e){return this.link=e,this}setName(e){return this.name=e,this}setShape(e){return this.shape=e,this}setHasBadge(e){return this.hasBadge=e,this}setHasAlert(e){return this.hasAlert=e,this}runOnClick(){this.onClick&&this.onClick(this)}}class z{constructor(){i(this,"version",""),i(this,"applicationId","memorial"),i(this,"applicationName","Memorial"),i(this,"developers",$),i(this,"production",!0),i(this,"platform","Web"),i(this,"relativeCacheService",!0),i(this,"serviceAPIHost",""),i(this,"redirectToServerAfterItIsReadyAdress",""),i(this,"portAutoDetection",!0),i(this,"portAutoIncrementValue",0),i(this,"defaultRoute","/compiler"),i(this,"coding",!0),i(this,"showOldVersions",!0),i(this,"useDictionaries",!1),i(this,"themeName","blue"),i(this,"serverType","rest"),i(this,"applications",[]),this.addApplication(d.builder().setId("about").setName("\u041e \u0441\u0430\u0439\u0442\u0435").setShape("home").setRoutes([h.builder().setLink("about").setName("\u041e \u0441\u0430\u0439\u0442\u0435").setShape("home")]).hide()).addApplication(d.builder().setId("d3examples").setName("\u041f\u0440\u0438\u043c\u0435\u0440\u044b D3").setShape("check-circle").setApplicationLogoText("D3|\u043f\u0440\u0438\u043c\u0435\u0440\u044b").setRoutes([h.builder().setLink("main-test").setName("\u041c\u043e\u043b\u0435\u0431\u0435\u043d").setShape("calendar"),h.builder().setLink("memorials-pages-editor").setName("\u0417\u0430\u043f\u0438\u0441\u043a\u0438").setShape("event"),h.builder().setLink("d3examples").setName("\u041f\u0440\u0438\u043c\u0435\u0440\u044b D3").setShape("image"),h.builder().setLink("dynamic-components-examples").setName("\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u0414\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442").setShape("blocks-group"),h.builder().setLink("help").setName("\u041f\u043e\u043c\u043e\u0449\u044c").setShape("help"),h.builder().setLink("tests").setName("\u0422\u0435\u0441\u0442\u044b").setShape("check-circle")]).hide()).addApplication(d.builder().setId("d3Dexamples").setName("\u041f\u0440\u0438\u043c\u0435\u0440\u044b 3D").setShape("scroll").setApplicationLogoText("Three.JS|\u043f\u0440\u0438\u043c\u0435\u0440\u044b").setRoutes([h.builder().setLink("d3Dexamples").setName("Three 3D").setShape("scroll")]).hide()).addApplication(d.builder().setId("books").setName("\u041a\u043d\u0438\u0433\u0438").setShape("my-logo-icon").setLibraryType("prod").setLibraryRef("biblia").setRoutes([h.builder().setLink("books").setName("\u041a\u043d\u0438\u0433\u0438").setShape("book")])).addApplication(d.builder().setId("memorial").setName("\u041f\u043e\u043c\u044f\u043d\u043d\u0438\u043a").setShape("my-logo-icon").setLibraryType("mprod").setLibraryRef("ps").setRoutes([h.builder().setLink("memorial").setName("\u041f\u043e\u043c\u044f\u043d\u043d\u0438\u043a").setShape("users")])).addApplication(d.builder().setId("calculator").setName("\u041a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0442\u043e\u0440").setShape("calculator").setLibraryType("cprod").setLibraryRef("calc").setApplicationLogoText("\u041c\u0410\u0422\u0410\u041d|\u043a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0442\u043e\u0440").setRoutes([h.builder().setLink("calculator").setName("\u041a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0442\u043e\u0440").setShape("calculator")]).hide()).addApplication(d.builder().setId("calendar").setName("\u041a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044c").setShape("calendar").setLibraryType("clndrprod").setLibraryRef("clndr").setRoutes([h.builder().setLink("calendar").setName("\u041a\u0430\u043b\u0435\u043d\u0434\u0430\u0440\u044c").setShape("calendar")]).hide()).addApplication(d.builder().setId("cross").setName("\u041a\u0440\u0435\u0441\u0442").setShape("my-logo-icon").setLibraryType("crossprod").setLibraryRef("cross").setRoutes([h.builder().setLink("cross").setName("\u041a\u0440\u0435\u0441\u0442").setShape("my-logo-icon")])).addApplication(d.builder().setId("compiler").setName("\u041a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440").setShape("bug").setLibraryType("compprod").setLibraryRef("comp").setApplicationLogoText("C-Js|\u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440").setRoutes([h.builder().setLink("compiler").setName("\u041a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440").setShape("bug")]).hide()).addApplication(d.builder().setId("scheduler").setName("\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435").setShape("alarm-clock").setLibraryType("schprod").setLibraryRef("sch").setRoutes([h.builder().setLink("scheduler").setName("\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435").setShape("alarm-clock")])).setVersion("BV."+S),this.afterConstruct()}addApplication(e){if(null!=this.applications.find(t=>t.id==e.id))throw new Error(`\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 "${e.id}" \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);return this.applications.push(e),this}setVersion(e){return this.version=e,this}setProduction(e){return this.production=e,this}setPlatform(e){return this.platform=e,this}setRelativeCacheService(e){return this.relativeCacheService=e,this}setServiceAPIHost(e){return this.serviceAPIHost=e,this}setRedirectToServerAfterItIsReadyAdress(e){return this.redirectToServerAfterItIsReadyAdress=e,this}setPortAutoDetection(e){return this.portAutoDetection=e,this}setPortAutoIncrementValue(e){return this.portAutoIncrementValue=e,this}setDefaultRoute(e){return this.defaultRoute=e,this}setServerType(e){return this.serverType=e,this}setCoding(e){return this.coding=e,this}setShowOldVersions(e){return this.showOldVersions=e,this}setUseDictionaries(e){return this.useDictionaries=e,this}afterConstruct(){}}class v extends z{afterConstruct(){super.afterConstruct(),this.setVersion("WPR."+S).setProduction(!0).setServiceAPIHost("").setRedirectToServerAfterItIsReadyAdress("").setPortAutoDetection(!0).setPortAutoIncrementValue(0).setDefaultRoute("/help").setServerType("memory"),this.applications.forEach((e,t,s)=>e.enable())}static builder(){return new v}}const u=v.builder();class T{constructor(e,t){i(this,"id",void 0),i(this,"handler",void 0),this.id=e,this.handler=t}static builder(){return new T(-1,()=>{})}setId(e){return this.id=e,this}setHandler(e){return this.handler=e,this}}class J{constructor(){i(this,"id",1),i(this,"handlers",new Map),i(this,"targetHandlers",new Map),i(this,"messagesToTarget",new Map),i(this,"messagesTimeoutMs",18e4)}newId(){return this.id++}putMessage(e){let t=e.target,s=this.messagesToTarget.get(t);return null==s&&(s=[]),s.push(e),s=this.removeOld(s),s?this.messagesToTarget.set(t,s):this.messagesToTarget.delete(t),this}getMessages(e,t=!0){let s=this.messagesToTarget.get(e),n=this.removeOld(s);return null==s&&t&&this.messagesToTarget.delete(e),n}removeAllOld(){let e=[];return this.messagesToTarget.forEach((t,s,n)=>{e.push(s)}),e.forEach(t=>{this.getMessages(t,!1)}),this}removeOld(e){if(void 0===e)return;let t=Date.now(),s=e.findIndex(o=>o.time+this.messagesTimeoutMs>t),n=e;return s>0&&(n=e.splice(0,s)),n}sendMessage(e){this.handlers.forEach((s,n,o)=>{s(e)});let t=this.targetHandlers.get(e.target);t&&t.forEach(s=>{s.handler(e)})}addHandler(e){let t=this.newId();this.handlers.set(t,e);let s=this;return{unsubscribe(){s.removeHandler(t)}}}addTargetHandler(e,t){let s=this.newId(),n=this.targetHandlers.get(e);null==n&&(n=[],this.targetHandlers.set(e,n)),n.push(T.builder().setId(s).setHandler(t));let o=this;return{unsubscribe(){o.removeTargetHandler(e,s)}}}removeAllTargetHandlers(e){return this.targetHandlers.delete(e),this}removeHandler(e){this.handlers.delete(e)}removeTargetHandler(e,t){let s=this.targetHandlers.get(e);if(s){let n=s.filter((o,a,l)=>o.id!=t);n.length?this.targetHandlers.set(e,n):this.targetHandlers.delete(e)}}}let L=new class U extends V{constructor(e=null){super(e),i(this,"cacheService",null)}setCacheService(e){return this.cacheService=e,this}post(e,t){switch(t.type){case M.TYPE:this.onLibraryInfoRequest(e,t);break;case N.TYPE:this.onBookInfoRequest(e,t);break;case O.TYPE:this.onBookRequest(e,t);break;case H.TYPE:this.onPagesRequest(e,t);break;default:throw new Error(`Unknown message type: ${t.type}.`)}return this}onLibraryInfoRequest(e,t){let s=D.builder().setCallbackId(t.id);t.libraryRef?this.loadLibraryInfo(t,s,t.libraryType+"/"+t.libraryRef+".library.txt",n=>{this.send(e,s)}):this.send(e,s)}loadLibraryInfo(e,t,s,n=null){let o=this.cacheService.getRestPoint(s,null);this.cacheService.getTextRestcallUrl(o,a=>{t.setMetaContent(a||"").setLibraryRef(e.libraryRef),n&&n(!!a)})}onBookInfoRequest(e,t){let s=Y.builder().setCallbackId(t.id);t.bookRef?this.loadBookInfo(t,s,t.libraryType+"/"+t.bookRef+".book.txt",n=>{this.send(e,s)}):this.send(e,s)}loadBookInfo(e,t,s,n=null){let o=this.cacheService.getRestPoint(s,null);this.cacheService.getTextRestcallUrl(o,a=>{t.setMetaContent(a||"").setBookRef(e.bookRef),n&&n(!!a)})}onBookRequest(e,t){let s=F.builder().setCallbackId(t.id),n=t.languages.map(o=>o);n.length||n.push("CS","Sinodal"),n=n.map(o=>g.merge("/"+t.libraryType,t.bookRef+"_"+o+"/index.txt")),t.bookRef?this.runAll(n,(o,a)=>{this.loadBookPath(t,s,o,a)},o=>{this.send(e,s)}):this.send(e,s)}loadBookPath(e,t,s,n=null){let o=this.cacheService.getRestPoint(s,null);this.cacheService.getTextRestcallUrl(o,a=>{t.addMetaBook(m.builder().setBookRef(e.bookRef).setPath(s).setContent(a||"")),n&&n(!!a)})}onPagesRequest(e,t){let s=q.builder().setCallbackId(t.id);this.runAll(t.pages,(n,o)=>{let a=this.findPathPrefix(n.bookPath),l=this.cacheService.getRestPoint(g.merge(a,n.bookPage),null);this.cacheService.getTextRestcallUrl(l,p=>{s.addPage(p||""),o(!0)})},n=>{this.send(e,s)})}findPathPrefix(e){let t=e.lastIndexOf("/");return e.substring(0,t)}}((r,e)=>{postMessage(r?b.builder().setWorkerId(r.workerId).setMessage(e):e)}),x=new class K{setDictionaries(e){return this.dictionaries=e,this}isShowLogin(){return this.showType==this.defaultLoginType}isShowNormal(){return"normal"==this.showType}isUseDictionaries(){return this.useDictionaries}setShowNormal(){return this.showType="normal",this}setShowLogin(e=null){return null!=e&&(this.autoLoginApplication=e),this.showType=this.defaultLoginType,this}get version(){return this.environment.version}get developerId(){let e="";return this.environment.developers.forEach(t=>{e=e+(e?"_":"")+t.id}),e}get developerName(){let e="";return this.environment.developers.forEach(t=>{e=e+(e?", ":"")+t.name}),e}get developerNameSortOrder(){let e="";return this.environment.developers.forEach(t=>{e=e+(e?", ":"")+t.nameSortOrder}),e}get developerLink(){return this.environment.developers[0].link}setPageLoadedFrom(e,t=!1){return this.pageLoadedFrom=e,t&&this.runPortAutoDetection(),this.setupBaseHref(),this}constructor(){i(this,"cache",new Map),i(this,"environment",u),i(this,"themeName",u.themeName),i(this,"serviceAPIHost",u.serviceAPIHost),i(this,"redirectToServerAfterItIsReadyAdress",u.redirectToServerAfterItIsReadyAdress),i(this,"portAutoDetection",u.portAutoDetection),i(this,"portAutoIncrementValue",u.portAutoIncrementValue),i(this,"messageBus",new J),i(this,"alerts",[]),i(this,"upperMenuEnabled",!0),i(this,"pageLoadedFrom",""),i(this,"authId",""),i(this,"authIdKey","authId"),i(this,"authBody",""),i(this,"baseHref",""),i(this,"waitingIOOperationCount",0),i(this,"waitingIOOperationValue",0),i(this,"waitingIOOperationValueMax",100),i(this,"outletOnly",!1),i(this,"autoLoginApplication",!0),i(this,"defaultApplication",""),i(this,"defaultLoginType","login"),i(this,"showType",this.defaultLoginType),i(this,"enableDefaultPersons",!0),i(this,"coding",u.coding),i(this,"showOldVersions",u.showOldVersions),i(this,"useDictionaries",u.useDictionaries),i(this,"dictionaries",null),typeof pageLoadedFrom<"u"&&this.setPageLoadedFrom(pageLoadedFrom),this.runPortAutoDetection(),this.setupBaseHref()}setupBaseHref(){let e=this.pageLoadedFrom;e.endsWith("/")&&(e=e.substring(0,e.length-1)),this.baseHref=e}runPortAutoDetection(){this.portAutoDetection&&(this.serviceAPIHost=this.doPortAutoDetection(this.serviceAPIHost?this.serviceAPIHost:this.pageLoadedFrom),this.redirectToServerAfterItIsReadyAdress=this.doPortAutoDetection(this.redirectToServerAfterItIsReadyAdress))}doPortAutoDetection(e){const t=e.lastIndexOf(":");if(t<0)return e;let s="";for(let a=t+1;a<e.length&&"0123456789".indexOf(e.charAt(a))>=0;++a)s+=e.charAt(a);return isNaN(+s)?e:e.substring(0,t)+":"+(+location.port+u.portAutoIncrementValue)+e.substring(t+1+s.length,e.length)}addAlert(e){e.setConfig(this),this.alerts.push(e)}removeAlert(e){const t=this.alerts.findIndex((s,n,o)=>s===e);t>=0&&this.alerts.splice(t,1)}isPlatformAndroid(){return"Android"===this.environment.platform}isPlatformWeb(){return"Web"===this.environment.platform}isPlatform(e){return this.environment.platform===e}isRelativeCacheService(){return this.environment.relativeCacheService}isRestServerType(){return"rest"===this.environment.serverType}isMemoryServerType(){return"memory"===this.environment.serverType}isServerType(e){return this.environment.serverType===e}isRedTheme(){return"red"===this.themeName}isBlueTheme(){return"blue"===this.themeName}isTheme(e){return this.themeName===e}isWaitingIO(){return this.waitingIOOperationCount>0}incWaitingIO(){return this.waitingIOOperationCount++}decWaitingIO(){return this.waitingIOOperationCount--}clearWaitingIO(){this.waitingIOOperationCount=0}post(e,t=0){setTimeout(()=>{e()},t)}getApplication(){let e=null;return this.environment.applications.forEach(t=>{t.id==this.defaultApplication&&(e=t)}),e}getApplicationByNameOrNull(e){let t=null;return this.environment.applications.forEach(s=>{s.name==e&&(t=s)}),t}getSingleAppOrNull(){let e=null,t=this.environment.applications.filter(s=>s.applicationEnabled&&!s.applicationHidden);return 1==t.length&&(e=t[0]),e}};L.setCacheService(new class W{get coding(){return this.config.coding}get restPoint(){return this.coding?"/staticb":this.sRestPoint}constructor(e,t="/static"){i(this,"config",void 0),i(this,"sRestPoint",void 0),i(this,"textCache",new Map),i(this,"waitingTextCache",new Map),this.config=e,this.sRestPoint=t}getRestPoint(e,t,s=null){const n=this.config.isRelativeCacheService()||this.config.isMemoryServerType()?this.config.baseHref:this.config.serviceAPIHost;return g.merge(g.merge(t||n,s??this.restPoint),e)}completeOnDone(e,t){let s=this.waitingTextCache.get(e);s&&(s.forEach(n=>{this.config.post(()=>{n&&n(t)})}),this.waitingTextCache.delete(e))}getTextRestcallUrl(e,t){if(this.coding){if(this.textCache.has(e)){let s=this.textCache.get(e);if(null!=s)return void this.config.post(()=>{t&&t(s)})}return this.waitingTextCache.has(e)?void(t&&this.waitingTextCache.get(e).push(t)):(t&&this.waitingTextCache.set(e,[t]),this.getBinRestcallUrlRaw(e,s=>{if(s){let n=new Uint8Array(s),o=P.fromByteArray(n);this.completeOnDone(e,o)}else t&&t(null)}))}return this.getTextRestcallUrlRaw(e,t)}getTextRestcallUrlRaw(e,t){if(this.textCache.has(e)){let n=this.textCache.get(e);if(null!=n)return void this.config.post(()=>{t&&t(n)})}if(this.waitingTextCache.has(e))t&&this.waitingTextCache.get(e).push(t);else{t&&this.waitingTextCache.set(e,[t]);var s=new XMLHttpRequest;s.onload=()=>{if(t){let n=4===s.readyState&&200===s.status?s.responseText:null;null!=n?this.textCache.set(e,n):this.textCache.delete(e),this.completeOnDone(e,n)}},s.open("get",e,!0),s.send()}}getBinRestcallUrlRaw(e,t){let s=e;if(this.coding){let o=s.lastIndexOf(".");o>=0&&(s=s.substring(0,o)+".bin")}var n=new XMLHttpRequest;n.onload=()=>{if(t){let a=new Uint8Array(4===n.readyState&&200===n.status?n.response:null),l=P.dtr(a,-1);t&&t(l)}},n.open("get",s,!0),n.responseType="arraybuffer",n.send()}}(x)),addEventListener("message",({data:r})=>{let e=r;if("string"==typeof e.message){const t=`worker response to ${r}`;postMessage(b.builder().setWorkerId(e.workerId).setMessage(t))}else e.message.type===B.TYPE?x.setPageLoadedFrom(e.message.pageLoadedFrom,!0):L.post(e,e.message)})})();